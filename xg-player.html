<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui">
  <meta name="referrer" content="no-referrer">
  <title>播放器</title>
  <style>
    * { box-sizing: border-box; }
    html, body { width: 100%; height: 100%; margin: 0; background: #000; color: #e5e7eb; }
    body { display: flex; align-items: stretch; justify-content: stretch; position: relative; overflow: hidden; }
    #mse { flex: 1; min-height: 0; }
    #status { position: absolute; top: 12px; left: 12px; padding: 8px 12px; background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.08); border-radius: 8px; font-size: 13px; color: #cbd5e1; pointer-events: none; }
  </style>
  <link rel="stylesheet" href="https://unpkg.byted-static.com/xgplayer/3.0.23/dist/index.min.css">
</head>
<body>
  <div id="mse"></div>
  <div id="status" aria-live="polite"></div>

  <script src="https://unpkg.byted-static.com/xgplayer/3.0.23/dist/index.min.js" charset="utf-8"></script>
  <script src="https://unpkg.byted-static.com/xgplayer-hls/3.0.23/dist/index.min.js" charset="utf-8"></script>
  <script src="https://unpkg.byted-static.com/xgplayer-flv/3.0.23/dist/index.min.js" charset="utf-8"></script>
  <script>
    (async function () {
      const params = new URLSearchParams(window.location.search);
      const streamUrl = (params.get('url') || '').trim();
      const isLive = params.get('isLive') !== 'false';
      const statusEl = document.getElementById('status');

      const updateStatus = text => { if (statusEl) statusEl.textContent = text; };

      if (!streamUrl) {
        updateStatus('缺少播放参数');
        return;
      }

      const detectType = (url, contentType = '') => {
        const lowerUrl = (url || '').toLowerCase();
        const lowerCt = (contentType || '').toLowerCase();
        if (
          lowerUrl.includes('.m3u8') ||
          lowerCt.includes('application/vnd.apple.mpegurl') ||
          lowerCt.includes('application/x-mpegurl')
        ) return 'hls';
        if (
          lowerUrl.includes('.flv') ||
          lowerUrl.startsWith('rtmp://') ||
          lowerCt.includes('video/x-flv')
        ) return 'flv';
        return 'unknown';
      };

      const resolveUrl = async url => {
        try {
          const response = await fetch(url, { method: 'GET', redirect: 'follow' });
          const finalUrl = response.url || url;
          const contentType = response.headers?.get?.('content-type') || '';
          return { url: finalUrl, contentType };
        } catch (error) {
          console.warn('解析地址失败，使用原始地址', error);
          return { url, contentType: '' };
        }
      };

      const buildOptions = (type, url) => {
        const options = {
          id: 'mse',
          isLive,
          playsinline: true,
          url,
          autoplay: true,
          width: '100%',
          height: '100%'
        };

        const plugins = [];

        if (type === 'hls') {
          if(isLive) {
            plugins.push(window.HlsLivePlayer)
          } else {
            plugins.push(window.HlsPlayer);
          }
        } 

        if (type === 'flv') {
          plugins.push(window.FlvPlayer);
        } 

        if (plugins.length) options.plugins = plugins;
        return options;
      };

      const { url: resolvedUrl, contentType } = await resolveUrl(streamUrl);
      const streamType = detectType(resolvedUrl, contentType);
      const options = buildOptions(streamType, resolvedUrl);

      try {
        window.player = new window.Player(options);
      } catch (error) {
        console.warn('初始化 xgplayer 失败', error);
        updateStatus('播放器失败');
      }
    })();
  </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"d722d971986142e4ae3477d859fe7006","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c46a37989422385',t:'MTc2OTUwMDAxMA=='};var a=document.createElement('script');a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
